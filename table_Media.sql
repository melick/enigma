USE enigma;

DROP TABLE `Media`;

-- field length = 16 * (trunc(string_length / 16) + 1)  per MySQL
CREATE TABLE `Media` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `Patrol` VARBINARY(64) NOT NULL,
    `date` DATE NOT NULL,
    `Steckerverbindungen` VARBINARY(256) NOT NULL,
    `Revision` VARBINARY(256) NOT NULL,
    `LastUpdate` DATETIME NOT NULL
)
ENGINE = InnoDB
COMMENT = "Record of media uploaded to Wrodpress Plog"
;

/*
-- SAMPLE CODE --
DECLARE @key VARCHAR(255);

DECLARE @Patrol VARCHAR(50);
DECLARE @Steckerverbindungen VARCHAR(255);
DECLARE @Revision VARCHAR(255);

-- SET @key = 'Red Stallion';
SET @key = UNHEX(SHA2('Red Stallion',512));


SET @Patrol = '12345678901234567890123456789012345678901234567890';
SET @Steckerverbindungen = '1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890ABCDE';
SET @Revision = '1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890ABCDE';

-- http://thinkdiff.net/mysql/encrypt-mysql-data-using-aes-techniques/
INSERT INTO `Media` (`Patrol`, `date`, `Steckerverbindungen`, `Revision`, `LastUpdate`) VALUES (
AES_ENCRYPT(@Patrol,@key),
'2016-06-16',
AES_ENCRYPT(@Steckerverbindungen,@key),
AES_ENCRYPT(@Revision,@key),
NOW());


SET @key = UNHEX(SHA2('Red Stallion',512));

SELECT AES_DECRYPT(`Patrol`,@key)
     , `date`
     , AES_DECRYPT(`Steckerverbindungen`,@key)
     , AES_DECRYPT(`Revision`,@key)
     , `LastUpdate`
  FROM `Media`;
*/


/* field size conversions
=16*(TRUNC(A2/16) + 1)
varchar varbinary
50      64
4       16
3       16
255     256
15      16
100     112
*/
